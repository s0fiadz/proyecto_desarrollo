{% extends 'core/base.html' %}

{% block content %}

<h4>Crear Encuesta</h4>
<hr>

{% if error %}
<div class="alert alert-danger">
    <strong>Error:</strong> {{ error }}
</div>
{% endif %}

<form method="post" action="{% url 'encuesta_create' %}" class="mt-3">
    {% csrf_token %}

    <div class="mb-3">
        <label class="form-label fw-bold">Título de la Encuesta</label>
        <input type="text" name="titulo" class="form-control" placeholder="Ingrese el título" required>
    </div>

    <div class="mb-3">
        <label class="form-label fw-bold">Tipo de Incidencia</label>
        <select name="tipo_incidencia" class="form-select" required>
            <option value="">Seleccione tipo de incidencia</option>
            {% for tipo in tipos_incidencia %}
            <option value="{{ tipo.id_tipo }}">{{ tipo.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label fw-bold">Descripción</label>
        <textarea name="descripcion" class="form-control" placeholder="Ingrese la descripción"></textarea>
    </div>

    <div class="form-check mb-4">
        <input type="checkbox" name="activo" class="form-check-input" id="activo" checked>
        <label class="form-check-label" for="activo">Activo</label>
    </div>

    <hr>
    <h5>Preguntas de la Encuesta</h5>

    <div id="preguntas-container" class="mt-3">
        <div class="pregunta-item input-group mb-2">
            <input type="text" name="preguntas[]" class="form-control" placeholder="Ingrese una pregunta" required>
            <button type="button" class="btn btn-outline-danger" onclick="eliminarPregunta(this)">
                ✕
            </button>
        </div>
    </div>

    <button type="button" class="btn btn-secondary mt-2" onclick="agregarPregunta()">
        + Agregar otra pregunta
    </button>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Crear Encuesta</button>
        <a href="{% url 'encuesta_list' %}" class="btn btn-outline-secondary">Volver a Encuestas</a>
    </div>
</form>

<script>
function agregarPregunta() {
    const container = document.getElementById('preguntas-container');
    const div = document.createElement('div');
    div.className = "pregunta-item input-group mb-2";
    div.innerHTML = `
        <input type="text" name="preguntas[]" class="form-control" placeholder="Ingrese una pregunta" required>
        <button type="button" class="btn btn-outline-danger" onclick="eliminarPregunta(this)">✕</button>
    `;
    container.appendChild(div);
}

function eliminarPregunta(button) {
    const total = document.querySelectorAll('.pregunta-item').length;
    if (total > 1) {
        button.parentElement.remove();
    } else {
        alert('Debe haber al menos una pregunta');
    }
}
</script>

{% endblock %}
