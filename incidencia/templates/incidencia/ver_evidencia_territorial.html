{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evidencia de Incidencia {{ incidencia.id_incidencia }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="mb-3 text-center">Evidencia de Incidencia #{{ incidencia.id_incidencia }}</h2>
    <hr>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title">Detalles de la Incidencia</h5>
            <p><strong>Descripci贸n:</strong> {{ incidencia.descripcion }}</p>
            <p><strong>Direcci贸n:</strong> {{ incidencia.direccion_incidente|default:"No especificada" }}</p>
            <p><strong>Prioridad:</strong> {{ incidencia.get_prioridad_display }}</p>
            <p><strong>Estado:</strong> {{ incidencia.get_estado_display }}</p>
        </div>
    </div>

    <h5 class="mb-3">Evidencias Subidas por la Cuadrilla</h5>

    {% if evidencia %}
        <div class="row">
            {% for reg in evidencia %}
                <div class="col-md-4 mb-4">
                    <div class="card shadow-sm">
                        {% if reg.evidencia %}
                            {% with reg.evidencia.name|lower as name %}
                                {% if ".jpg" in name or ".jpeg" in name or ".png" in name or ".gif" in name or ".webp" in name %}
                                    <img src="{{ reg.evidencia.url }}" class="card-img-top" alt="Evidencia">
                                {% else %}
                                    <div class="p-3 text-center">
                                        <a href="{{ reg.evidencia.url }}" target="_blank" class="btn btn-sm btn-info text-white">
                                            Ver archivo adjunto
                                        </a>
                                    </div>
                                {% endif %}
                            {% endwith %}
                        {% endif %}
                        <div class="card-body">
                            <p><strong>Descripci贸n:</strong> {{ reg.descripcion|default:"Sin descripci贸n" }}</p>
                            <p><small class="text-muted">Subido el {{ reg.fecha_cierre|date:"d/m/Y" }}</small></p>

                            {% if reg.comentario_territorial %}
                                <div class="alert alert-info mt-2 mb-0">
                                    <strong>Comentario del Territorial:</strong><br>
                                    {{ reg.comentario_territorial }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No hay evidencia registrada para esta incidencia.</p>
    {% endif %}

    {% if incidencia.estado == "finalizada" %}
        <div class="text-center mt-4">
            <a href="{% url 'incidencia:evaluar_evidencia' incidencia.id_incidencia 'cerrar' %}" class="btn btn-info text-white me-2">
                Cerrar incidencia
            </a>
            <a href="{% url 'incidencia:evaluar_evidencia' incidencia.id_incidencia 'proceso' %}" class="btn btn-info text-white">
                Devolver a proceso
            </a>
        </div>
    {% endif %}

    <div class="text-center mt-4">
        <a href="{% url 'incidencia:incidencia_list' %}" class="btn btn-secondary">Volver a la lista</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>